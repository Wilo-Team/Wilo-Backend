# yaml-language-server: $schema=https://coderabbit.ai/integrations/schema.v2.json

language: "ko-KR"
early_access: true

tone_instructions: >
  한국어로 정중하고 협업적인 톤의 코드 리뷰를 제공합니다.
  Spring Boot/JPA 백엔드 품질 개선에 집중합니다.

reviews:
  profile: "assertive"
  high_level_summary: true
  changed_files_summary: true
  review_status: true
  collapse_walkthrough: true
  abort_on_close: true

  path_filters:
    - "src/**"
    - ".github/**"
    - ".coderabbit.yaml"
    - "Dockerfile"
    - "docker-compose*.yml"
    - "build.gradle"
    - "settings.gradle"
    - "!build/**"
    - "!out/**"
    - "!.gradle/**"
    - "!gradle/wrapper/**"
    - "!gradlew"
    - "!gradlew.bat"
    - "!**/*.png"
    - "!**/*.jpg"
    - "!**/*.jpeg"
    - "!**/*.svg"
    - "!**/*.lock"
    - "!**/*.md"

  path_instructions:
    - path: "src/**"
      instructions: |
        [리뷰 우선순위]
        1) 보안/인증: JWT, 권한 체크, 입력값 검증 누락
        2) 정합성: 트랜잭션 경계, 동시성/경합 가능성
        3) 성능: N+1, 불필요한 쿼리/인덱스 미사용, 과도한 로딩
        4) 설계/가독성: 계층 분리, 책임/네이밍, 예외 처리

        [Spring / JPA 체크리스트]
        - 필드 주입 금지, 생성자 주입 사용
        - @Transactional 경계가 맞는지(읽기 readOnly=true 권장)
        - N+1 가능성 지적 및 대안 제시(fetch join, batch size, projection 등)
        - 영속성 컨텍스트/지연로딩으로 인한 예기치 않은 쿼리 여부
        - 조회 API는 필요한 필드만(Projection/DTO)로 최소화
        - 페이징 + fetch join 조합 주의(카운트 쿼리/중복 row)

        [검증 책임 분리]
        - API Layer: 형식 검증(@Valid, @NotNull 등)
        - Service Layer: 비즈니스 규칙 검증(권한/상태/정합성)
        - 중복 검증은 피하고, Service 위반은 Custom BusinessException 사용

        [네이밍/레이어 규칙]
        - 패키지: 소문자, 클래스/인터페이스: PascalCase, 변수/메서드: camelCase
        - Controller: {Domain}Controller
        - API Interface(Swagger): {Domain}Api
        - Service 인터페이스: {Domain}Usecase
        - Service 구현체: {Domain}Service
        - Repository: {Domain}Repository
        - DTO: CreateXXRequest / CreateXXResponse
        - ErrorCode/SuccessCode/Exception: 도메인 단위로 분리

        [로깅]
        - request/response/DTO 전체를 그대로 로그로 남기지 말 것(PII/토큰/비밀번호)
        - toString() fallback 사용 시 예외/민감정보/대용량 출력 방지(try-catch + truncate)

  auto_review:
    enabled: true
    drafts: false
    base_branches:
      - "main"
      - "develop"
    labels:
      - "!wip"
      - "!draft"
      - "!skip-review"

  tools:
    gitleaks:
      enabled: true
    yamllint:
      enabled: true
    actionlint:
      enabled: true

chat:
  auto_reply: true
  art: false

knowledge_base:
  web_search:
    enabled: true